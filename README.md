# Davie et al 2018

## A Single-Cell Transcriptome Atlas of the Aging Drosophila Brain

https://doi.org/10.1016/j.cell.2018.05.057

## from Paper M&M
### 10x Genomics
Single-cell libraries were generated using the GemCode Single-Cell Instrument and Single Cell 30 Library & Gel Bead Kit v2 and Chip Kit (10x Genomics) according to the manufacturer’s protocol. Briefly, fly brain single cells were suspended in 0.04% BSA–PBS. About 8,700 cells were added to each channel with a targeted cell recovery estimate of 5,000 cells. After generation of nanoliter-scale Gel bead-in-EMulsions (GEMs), GEMs were reverse transcribed in a C1000 Touch Thermal Cycler (Bio Rad) programed at 53 C for 45 min, 85 C for 5 min, and hold at 4 C. After reverse transcription, single-cell droplets were broken and the single-strand cDNA was isolated and cleaned with Cleanup Mix containing DynaBeads (Thermo Fisher Scientific). cDNA was then amplified with a C1000 Touch Thermal Cycler programed at 98 C for 3 min, 12 cycles of (98 C for 15 s, 67 C for 20 s, 72 C for 1 min), 72 C for 1 min, and held at 4 C twice. Subsequently, the amplified cDNA was fragmented, end-repaired, A-tailed and index adaptor ligated, with SPRIselect Reagent Kit (Beckman Coulter) with cleanup in between steps. Post-ligation product was amplified with a C1000 Touch Thermal Cycler programed at 98 C for 45 s, 14 cycles of (98 C for 20 s, 54 C for 30 s, 72 C for 20 s), 72 C for 1 min, and hold at 4 C. The sequencing-ready library was cleaned up with SPRIselect beads.

### Raw Datasets
The 10x fly brain samples were each processed (alignment, barcode assignment and UMI counting) with Cell Ranger (version 2.0.0) count pipeline. The Cell Ranger reference index was built upon the 3rd 2017 FlyBase release (D. melanogaster r6.16) (Gramates et al., 2017). Median saturation was calculated as the median of the Sequencing Saturation metric reported by the CellRanger software.

### 10x Data Preprocessing
All samples but the ones with short dissociation protocol (SDP) were selected to build the high-quality datasets. The –recovered-cells parameter was specified for each Cell Ranger run with the number of cells that we expected to recover for each individual single- library (Table S1). Therefore, the number of cells in each sample was estimated by the Cell Ranger cell detection algorithm. The final raw DGRP-551 dataset was built by aggregating all the DGRP-551 samples using Cell Ranger aggregation pipeline without applying any Cell Ranger normalization method. The final raw w1118 dataset was built in the same way as the DGRP-551 dataset. Final dimen- sions of the raw DGRP-551 and w1118 datasets are 17,473 by 32,277, and 17,473 genes by 31,951 cells, respectively.
A large dataset of 157,390 cells (all samples in Table S1) was generated using a custom method to select the cells, less stringent than the one from Cell Ranger (Figure S1G). A common technique to discriminate cell-associated barcodes and the barcodes asso- ciated with empty partitions is to plot the cumulative fraction of reads/UMIs for all barcodes and look at its ‘‘knee.’’ The true cell barcodes would be assigned to the barcodes below the cut-off defined by the location of the knee. A new method was used to detect this ‘‘knee.’’ This method is based on the 10x publicly available dataset 1:1 mixture of fresh frozen human (HEK293T) and mouse (NIH 3T3) cells. The total UMIs associated to each raw barcode was computed per species and this was used to plot the cumulative frac- tion of UMIs plot for all barcodes. Each barcode is considered as a mixed cell if less than 95% of the UMIs are not associated to one of the 2 species. With this, the cumulative fraction of mixed cells was computed. This number is almost flat for first top barcodes but then starts to grow linearly. A linear model was fitted through the linear part of the cumulative fraction of mixed cells (25,000th to 50,000th barcode). The fitted model intersected the x axis at $12,419 which is very close to the expected number of cells (12k). A spline was fitted to the cumulative fraction of UMIs in order to find the tangent at this intercept. The angle of the tangent was then used as cut-off for each single-library dataset to discriminate the true cell barcodes from the empty partitions.
Cell Ranger uses a cell detection algorithm to discriminate true cell barcodes from empty partitions. To clean the data further, qual- ity control and filtering based on scater (McCarthy et al., 2017) applied on each dataset. Genes not expressed in any cells were removed, leaving 13,991 genes for the DGRP-551 dataset and 13,581 for the w1118 dataset. Then, a principal component analysis (PCA) based on quality metrics (calculated by the scater R-package was performed for each cell. If the cell’s metrics deviated more than 5 absolute deviations from the median, the cell was flagged as an outlier. The number of cells passing the quality controls are 29,137 and 27,765 respectively for DGRP-551 and w1118. Finally, low-abundance genes, defined as those with an average count below a filter threshold of 0.001 were removed. Dimensions of the final preprocessed DGRP-551 and w1118 datasets are 9,461 genes by 29,137 cells, and 9,349 genes by 27,765 cells, respectively.
